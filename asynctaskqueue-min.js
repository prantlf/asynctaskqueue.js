(function(i,s){var d,t;if(typeof define<"u"&&define.amd)define("asynctaskqueue",["underscore","jquery"],function(u,e){return s(u,e)});else if(typeof module<"u"&&typeof module.exports<"u"){const u=require("underscore"),e=require("jquery");module.exports=s(u,e)}else if(typeof i<"u"){if(typeof _>"u")throw new Error("Underscore.js not detected.");if(typeof jQuery>"u")throw new Error("JQuery not detected.");d=i.AsyncTaskQueue,i.AsyncTaskQueue=t=s(_,jQuery),t.noConflict=function(){return i.AsyncTaskQueue=d,t}}else throw new Error("JavaScript environment not recognized.")})(typeof window<"u"?window:this,function(i,s){function d(e,n){this.worker=e,this.deferred=s.Deferred()}i.extend(d.prototype,{promise:function(){return this.deferred.promise()}});function t(e){}i.extend(t.prototype,{push:function(e,n){e.push(n)},pop:function(e){return e.shift()}});function u(e){e||(e={}),this.parallelism=e.parallelism||1/0,this.asynchronous=e.asynchronous,e.Task&&(this.Task=e.Task),e.Scheduler&&(this.Scheduler=e.Scheduler),this.pending=[],this.processing=[],this.deferred=s.Deferred(),this.scheduler=new t(this,e.scheduler)}return i.extend(u.prototype,{Task:d,Scheduler:t,enqueue:function(e,n){return e instanceof this.Task||(e=new this.Task(e,n)),this.scheduler.push(this.pending,e),this._schedule(),e},dequeue:function(e){var n=this._index(this.pending,e);if(n>=0)return this.pending.splice(n,1)[0]},promise:function(){return this.deferred.promise()},empty:function(){return!(this.pending.length||this.processing.length)},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this._schedule(),this},abort:function(){return this.pending=[],this.processing.length?this.promise():s.Deferred.resolve().promise()},_schedule:function(){var e;!this.paused&&this.processing.length<this.parallelism&&(e=this.scheduler.pop(this.pending))&&(this.processing.push(e),this.deferred.notify({scheduled:!0}),this._execute(e),this._schedule())},_execute:function(e){var n=this;function r(){try{e.worker().progress(e.deferred.notify).done(e.deferred.done).fail(e.deferred.fail).always(function(){n._finish(e)})}catch(h){e.deferred.reject(h),n._finish(e)}}this.asynchronous?typeof setImmediate<"u"?setImmediate(r):setTimeout(r,0):r()},_finish:function(e){var n=this._index(this.processing,e);this.processing.splice(n,1),this.empty()?(this.deferred.resolve(),this.deferred=s.Deferred()):this._schedule()},_index:function(e,n){var r;for(n instanceof this.Task&&(n=n.worker),r=0;r<e.length;++r)if(e[r].worker===n)return r;return-1}}),u.version="2.0.4",u});
//# sourceMappingURL=asynctaskqueue-min.js.map
