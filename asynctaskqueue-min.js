//     asynctaskqueue.js 2.0.1
//     https://github.com/prantlf/asynctaskqueue.js
//     (c) 2014-2019 Ferdinand Prantl <prantlf@gmail.com>
//     Freely distributable under the MIT license
!function(e,r,i,n){var t,s;if("undefined"!=typeof define)define("asynctaskqueue",["underscore","jquery"],function(e,r){return n(e,r)});else if("undefined"!=typeof module&&void 0!==module.exports)r=require("underscore"),i=require("jquery"),module.exports=n(r,i);else{if(void 0===e)throw new Error("JavaScript environment not recognized.");if(void 0===r)throw new Error("Underscore.js not detected.");if(void 0===i)throw new Error("JQuery not detected.");t=e.AsyncTaskQueue,e.AsyncTaskQueue=s=n(r,i),s.noConflict=function(){return e.AsyncTaskQueue=t,s}}}(window,_,jQuery,function(e,i){function r(e,r){this.worker=e,this.deferred=i.Deferred()}function n(e){}
// * Task         - object to wrap the workers with (`Task` by default)
// * Scheduler    - object to push pending workers to the queue and pop
// * scheduler    - the optional parameter to be passed to the
function t(e){e||(e={}),this.parallelism=e.parallelism||1/0,this.asynchronous=e.asynchronous,e.Task&&(this.Task=e.Task),e.Scheduler&&(this.Scheduler=e.Scheduler),this.pending=[],this.processing=[],this.deferred=i.Deferred(),this.scheduler=new n(this,e.scheduler)}return e.extend(r.prototype,{promise:function(){return this.deferred.promise()}}),e.extend(n.prototype,{push:function(e,r){e.push(r)},pop:function(e){return e.shift()}}),e.extend(t.prototype,{Task:r,Scheduler:n,enqueue:function(e,r){return e instanceof this.Task||(e=new this.Task(e,r)),this.scheduler.push(this.pending,e),this._schedule(),e},dequeue:function(e){var r=this._index(this.pending,e);if(0<=r)return this.pending.splice(r,1)[0]},promise:function(){return this.deferred.promise()},empty:function(){return!(this.pending.length||this.processing.length)},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this._schedule(),this},abort:function(){return this.pending=[],this.processing.length?this.promise():i.Deferred.resolve().promise()},_schedule:function(){var e;!this.paused&&this.processing.length<this.parallelism&&(e=this.scheduler.pop(this.pending))&&(this.processing.push(e),this.deferred.notify({scheduled:!0}),this._execute(e),this._schedule())},_execute:function(r){var i=this;function e(){try{r.worker().progress(r.deferred.notify).done(r.deferred.done).fail(r.deferred.fail).always(function(){i._finish(r)})}catch(e){r.deferred.reject(e),i._finish(r)}}this.asynchronous?"undefined"!=typeof setImmediate?setImmediate(e):setTimeout(e,0):e()},_finish:function(e){var r=this._index(this.processing,e);this.processing.splice(r,1),this.empty()?(this.deferred.resolve(),this.deferred=i.Deferred()):this._schedule()},_index:function(e,r){var i;for(r instanceof this.Task&&(r=r.worker),i=0;i<e.length;++i)if(e[i].worker===r)return i;return-1}}),t.version="1.0.0",t});